<app-navbar>
  <div class="page-header">
    <div class="header-content">
      <div class="header-left">
        <button class="back-btn" (click)="cancel()">
          <svg width="20" height="20" viewBox="0 0 20 20" fill="none">
            <path d="M12.5 15L7.5 10L12.5 5" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
          </svg>
        </button>
        <div>
          <h1 class="page-title">{{ isEditMode ? 'Edit Category' : 'New Category' }}</h1>
          <p class="page-subtitle">{{ isEditMode ? 'Update category information' : 'Create a new custom category' }}</p>
        </div>
      </div>
    </div>
  </div>

  <div class="page-content">
    <div class="form-container">
      <form [formGroup]="categoryForm" (ngSubmit)="onSubmit()" class="category-form">

        <div *ngIf="errorMessage" class="error-banner">
          <svg width="20" height="20" viewBox="0 0 20 20" fill="none">
            <path d="M10 6V10M10 14H10.01M19 10C19 14.9706 14.9706 19 10 19C5.02944 19 1 14.9706 1 10C1 5.02944 5.02944 1 10 1C14.9706 1 19 5.02944 19 10Z" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
          </svg>
          <span>{{ errorMessage }}</span>
        </div>

        <!-- Type Selector -->
        <div class="form-group">
          <label>Type *</label>
          <div class="type-toggle">
            <button
              type="button"
              class="type-toggle-btn"
              [class.active]="selectedType === 'income'"
              (click)="selectType('income')">
              <svg width="16" height="16" viewBox="0 0 16 16" fill="none">
                <path d="M8 12V4M4 8L8 4L12 8" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
              </svg>
              Income
            </button>
            <button
              type="button"
              class="type-toggle-btn"
              [class.active]="selectedType === 'expense'"
              (click)="selectType('expense')">
              <svg width="16" height="16" viewBox="0 0 16 16" fill="none">
                <path d="M8 4V12M4 8L8 12L12 8" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
              </svg>
              Expense
            </button>
          </div>
        </div>

        <!-- Category Name -->
        <div class="form-group">
          <label for="name">Category Name *</label>
          <input
            id="name"
            type="text"
            formControlName="name"
            placeholder="Ex: Food, Transport, Salary..."
            [class.error]="categoryForm.get('name')?.invalid && categoryForm.get('name')?.touched">
          <div class="error-text" *ngIf="categoryForm.get('name')?.hasError('required') && categoryForm.get('name')?.touched">
            Name is required
          </div>
          <div class="error-text" *ngIf="categoryForm.get('name')?.hasError('minlength') && categoryForm.get('name')?.touched">
            Minimum 2 characters
          </div>
        </div>

        <!-- Icon Selector -->
        <div class="form-group">
          <label>Icon *</label>
          <div class="icon-grid">
            <button
              *ngFor="let icon of icons"
              type="button"
              class="icon-btn"
              [class.active]="selectedIcon === icon"
              (click)="selectIcon(icon)">
              {{ icon }}
            </button>
          </div>
        </div>

        <!-- Color Selector -->
        <div class="form-group">
          <label>Color *</label>
          <div class="color-grid">
            <button
              *ngFor="let color of colors"
              type="button"
              class="color-btn"
              [class.active]="selectedColor === color"
              [style.background]="color"
              (click)="selectColor(color)">
              <svg *ngIf="selectedColor === color" width="16" height="16" viewBox="0 0 16 16" fill="none">
                <path d="M13.3333 4L6 11.3333L2.66667 8" stroke="white" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
              </svg>
            </button>
          </div>
        </div>

        <!-- Preview -->
        <div class="form-group">
          <label>Preview</label>
          <div class="preview-card">
            <div class="preview-icon" [style.background]="selectedColor + '20'">
              <span [style.color]="selectedColor">{{ selectedIcon }}</span>
            </div>
            <div class="preview-info">
              <h3>{{ categoryForm.get('name')?.value || 'Category Name' }}</h3>
              <span class="preview-badge" [class.expense]="selectedType === 'expense'" [class.income]="selectedType === 'income'">
                {{ selectedType === 'expense' ? 'Expense' : 'Income' }}
              </span>
            </div>
          </div>
        </div>

        <!-- Actions -->
        <div class="form-actions">
          <button type="button" class="btn-secondary" (click)="cancel()" [disabled]="isLoading">
            Cancel
          </button>
          <button type="submit" class="btn-primary" [disabled]="isLoading">
            <span *ngIf="!isLoading">{{ isEditMode ? 'Update Category' : 'Create Category' }}</span>
            <span *ngIf="isLoading">{{ isEditMode ? 'Updating...' : 'Creating...' }}</span>
          </button>
        </div>
      </form>
    </div>
  </div>
</app-navbar>